# éƒ¨ç½²æ­¥éª¤ - æŒ‰é¡ºåºæ‰§è¡Œ

## âœ… å½“å‰çŠ¶æ€
- âœ… æœåŠ¡å™¨å·²è¿žæŽ¥
- âœ… åŸŸåè§£æžå·²ç”Ÿæ•ˆï¼ˆjubianai.cn â†’ 119.45.121.152ï¼‰

---

## ðŸ“ ç¬¬ä¸€æ­¥ï¼šæ›´æ–°ç³»ç»Ÿå¹¶å®‰è£…åŸºç¡€çŽ¯å¢ƒ

åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼ˆå·²è¿žæŽ¥çš„æƒ…å†µä¸‹ï¼‰ï¼š

```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£… Node.jsï¼ˆä½¿ç”¨ NVMï¼‰
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
source ~/.bashrc
nvm install 20
nvm use 20
nvm alias default 20

# éªŒè¯ Node.js å®‰è£…
node -v
npm -v

# å®‰è£… PM2ï¼ˆè¿›ç¨‹ç®¡ç†ï¼‰
npm install -g pm2

# é…ç½® PM2 å¼€æœºè‡ªå¯
pm2 startup
# æ‰§è¡Œä¸Šé¢å‘½ä»¤è¾“å‡ºçš„æç¤ºå‘½ä»¤ï¼ˆé€šå¸¸æ˜¯ sudo å¼€å¤´çš„ï¼‰

# å®‰è£… Nginx
sudo apt install nginx -y
sudo systemctl start nginx
sudo systemctl enable nginx

# å®‰è£… Git
sudo apt install git -y

# åˆ›å»ºé¡¹ç›®ç›®å½•
sudo mkdir -p /var/www/aigc-agent
sudo chown ubuntu:ubuntu /var/www/aigc-agent
```

---

## ðŸ“¦ ç¬¬äºŒæ­¥ï¼šä¸Šä¼ ä»£ç åˆ°æœåŠ¡å™¨

### æ–¹æ³•1ï¼šä½¿ç”¨ Gitï¼ˆå¦‚æžœä»£ç åœ¨ GitHubï¼‰

```bash
cd /var/www/aigc-agent
git clone https://github.com/ä½ çš„ç”¨æˆ·å/AIGC-jubianage-agent.git .
```

### æ–¹æ³•2ï¼šä½¿ç”¨ SCPï¼ˆä»Žæœ¬åœ° Windows ä¸Šä¼ ï¼‰

**åœ¨ Windows PowerShell ä¸­æ‰§è¡Œï¼ˆæ–°å¼€ä¸€ä¸ªçª—å£ï¼‰ï¼š**

```powershell
cd C:\Users\Administrator\Desktop\AIGC-jubianage-agent

# ä¸Šä¼ ä»£ç ï¼ˆæŽ’é™¤ node_modules å’Œ .gitï¼‰
scp -r -o StrictHostKeyChecking=no `
    --exclude=node_modules `
    --exclude=.git `
    --exclude=dist `
    . ubuntu@119.45.121.152:/var/www/aigc-agent/
```

**æˆ–è€…ä½¿ç”¨ WinSCP ç­‰å›¾å½¢åŒ–å·¥å…·ä¸Šä¼ æ•´ä¸ªé¡¹ç›®æ–‡ä»¶å¤¹**

---

## âš™ï¸ ç¬¬ä¸‰æ­¥ï¼šé…ç½®çŽ¯å¢ƒå˜é‡

```bash
cd /var/www/aigc-agent/server
cp env.example .env
nano .env
```

**å¿…é¡»é…ç½®ä»¥ä¸‹å†…å®¹ï¼š**

```env
# æœåŠ¡å™¨ç«¯å£
PORT=3002

# Supabase æ•°æ®åº“è¿žæŽ¥å­—ç¬¦ä¸²
DATABASE_URL=ä½ çš„Supabaseè¿žæŽ¥å­—ç¬¦ä¸²

# JWT å¯†é’¥ï¼ˆç”Ÿæˆä¸€ä¸ªéšæœºå­—ç¬¦ä¸²ï¼‰
JWT_SECRET=ä½ çš„JWTå¯†é’¥ï¼ˆè‡³å°‘32å­—ç¬¦ï¼‰

# è…¾è®¯äº‘ COS é…ç½®
COS_SECRET_ID=ä½ çš„COS_SECRET_ID
COS_SECRET_KEY=ä½ çš„COS_SECRET_KEY
COS_REGION=ap-guangzhou
COS_BUCKET=ä½ çš„bucketåç§°

# å„ç§ API Keyï¼ˆæ ¹æ®ä½ çš„éœ€è¦é…ç½®ï¼‰
NANO_BANANA_API_KEY=ä½ çš„API_KEY
MIDJOURNEY_API_KEY=ä½ çš„API_KEY
# ... å…¶ä»– API Key
```

**ç”Ÿæˆ JWT_SECRETï¼š**
```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

**ä¿å­˜æ–‡ä»¶ï¼š** `Ctrl+O` â†’ `Enter` â†’ `Ctrl+X`

---

## ðŸ”¨ ç¬¬å››æ­¥ï¼šå®‰è£…ä¾èµ–å¹¶æž„å»º

```bash
cd /var/www/aigc-agent

# å®‰è£…å‰ç«¯ä¾èµ–
npm install

# åˆ›å»ºç”Ÿäº§çŽ¯å¢ƒå˜é‡æ–‡ä»¶
cat > .env.production << 'EOF'
VITE_API_BASE_URL=https://jubianai.cn/api
EOF

# æž„å»ºå‰ç«¯
npm run build

# å®‰è£…åŽç«¯ä¾èµ–
cd server
npm install
```

---

## ðŸš€ ç¬¬äº”æ­¥ï¼šå¯åŠ¨åŽç«¯æœåŠ¡

```bash
cd /var/www/aigc-agent/server

# æµ‹è¯•çŽ¯å¢ƒå˜é‡
npm run check-env

# å¯åŠ¨æœåŠ¡
pm2 start index.js --name aigc-backend

# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs aigc-backend

# ä¿å­˜ PM2 é…ç½®
pm2 save
```

---

## ðŸŒ ç¬¬å…­æ­¥ï¼šé…ç½® Nginx

```bash
sudo nano /etc/nginx/sites-available/aigc-agent
```

**å¤åˆ¶ä»¥ä¸‹å†…å®¹ï¼š**

```nginx
server {
    listen 80;
    server_name jubianai.cn www.jubianai.cn;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /var/www/aigc-agent/dist;
        try_files $uri $uri/ /index.html;
        index index.html;
    }

    # åŽç«¯ API ä»£ç†
    location /api {
        proxy_pass http://localhost:3002;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
```

**ä¿å­˜å¹¶å¯ç”¨ï¼š**
```bash
# ä¿å­˜ï¼šCtrl+O â†’ Enter â†’ Ctrl+X

# åˆ›å»ºè½¯é“¾æŽ¥
sudo ln -s /etc/nginx/sites-available/aigc-agent /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡æ–°åŠ è½½ Nginx
sudo systemctl reload nginx
```

---

## ðŸ”’ ç¬¬ä¸ƒæ­¥ï¼šé…ç½® SSL è¯ä¹¦ï¼ˆHTTPSï¼‰

```bash
# å®‰è£… Certbot
sudo apt install certbot python3-certbot-nginx -y

# èŽ·å– SSL è¯ä¹¦ï¼ˆæ›¿æ¢ä¸ºä½ çš„é‚®ç®±ï¼‰
sudo certbot --nginx -d jubianai.cn -d www.jubianai.cn --email your@email.com --agree-tos --non-interactive
```

---

## ðŸ”¥ ç¬¬å…«æ­¥ï¼šé…ç½®é˜²ç«å¢™

```bash
# æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€
sudo ufw status

# å¼€æ”¾å¿…è¦ç«¯å£
sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# å¯ç”¨é˜²ç«å¢™
sudo ufw enable
```

---

## âœ… ç¬¬ä¹æ­¥ï¼šéªŒè¯éƒ¨ç½²

### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# æ£€æŸ¥ PM2
pm2 status

# æ£€æŸ¥ Nginx
sudo systemctl status nginx

# æ£€æŸ¥ç«¯å£
sudo netstat -tlnp | grep 3002
sudo netstat -tlnp | grep 80
```

### 2. æµ‹è¯•è®¿é—®

- è®¿é—®ï¼š`http://jubianai.cn` æˆ– `https://jubianai.cn`
- åº”è¯¥èƒ½çœ‹åˆ°ç™»å½•é¡µé¢
- æµ‹è¯•ç™»å½•åŠŸèƒ½

---

## ðŸ› é‡åˆ°é—®é¢˜ï¼Ÿ

### æ— æ³•è®¿é—®ç½‘ç«™
```bash
# æ£€æŸ¥ Nginx çŠ¶æ€
sudo systemctl status nginx

# æ£€æŸ¥ PM2 çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs aigc-backend
sudo tail -f /var/log/nginx/error.log
```

### åŽç«¯æ— æ³•å¯åŠ¨
```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
pm2 logs aigc-backend --lines 100

# æ£€æŸ¥çŽ¯å¢ƒå˜é‡
cd /var/www/aigc-agent/server
cat .env

# æ‰‹åŠ¨æµ‹è¯•å¯åŠ¨
node index.js
```

### æ•°æ®åº“è¿žæŽ¥å¤±è´¥
```bash
# æµ‹è¯•æ•°æ®åº“è¿žæŽ¥
cd /var/www/aigc-agent/server
node db/testSupabaseConnection.js

# æ£€æŸ¥ DATABASE_URL
grep DATABASE_URL .env
```

---

## ðŸ“ž éœ€è¦å¸®åŠ©ï¼Ÿ

æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ï¼š
- `docs/è…¾è®¯äº‘éƒ¨ç½²å®Œæ•´æŒ‡å—.md`
- `å¿«é€Ÿéƒ¨ç½²å‘½ä»¤.md`

