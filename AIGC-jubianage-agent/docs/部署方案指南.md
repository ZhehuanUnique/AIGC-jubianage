# é¡¹ç›®éƒ¨ç½²æ–¹æ¡ˆæŒ‡å—

## é—®é¢˜è¯´æ˜

Vercel æœ‰ 250MB çš„éƒ¨ç½²é™åˆ¶ï¼Œå¯¹äºåŒ…å«å¤§é‡ä¾èµ–å’Œèµ„æºæ–‡ä»¶çš„é¡¹ç›®å¯èƒ½ä¸å¤Ÿç”¨ã€‚æœ¬æ–‡æ¡£æä¾›å¤šç§éƒ¨ç½²æ–¹æ¡ˆä¾›é€‰æ‹©ã€‚

## éƒ¨ç½²æ–¹æ¡ˆå¯¹æ¯”

### 1. Railwayï¼ˆæ¨èï¼‰â­

**ä¼˜ç‚¹ï¼š**
- å…è´¹é¢åº¦ï¼š$5/æœˆï¼ˆ500å°æ—¶è¿è¡Œæ—¶é—´ï¼‰
- æ— æ–‡ä»¶å¤§å°é™åˆ¶
- æ”¯æŒ Node.jsã€PostgreSQL
- è‡ªåŠ¨ HTTPS
- ç®€å•æ˜“ç”¨ï¼ŒGitHub é›†æˆ
- æ”¯æŒç¯å¢ƒå˜é‡
- æ”¯æŒè‡ªå®šä¹‰åŸŸå

**ç¼ºç‚¹ï¼š**
- å…è´¹é¢åº¦æœ‰é™ï¼Œè¶…å‡ºéœ€ä»˜è´¹
- å›½å†…è®¿é—®å¯èƒ½è¾ƒæ…¢

**é€‚ç”¨åœºæ™¯ï¼š** ä¸­å°å‹é¡¹ç›®ï¼Œéœ€è¦ç®€å•éƒ¨ç½²

**éƒ¨ç½²æ­¥éª¤ï¼š**
1. è®¿é—® [Railway.app](https://railway.app)
2. ä½¿ç”¨ GitHub è´¦å·ç™»å½•
3. ç‚¹å‡» "New Project" â†’ "Deploy from GitHub repo"
4. é€‰æ‹©ä½ çš„ä»“åº“
5. é…ç½®ç¯å¢ƒå˜é‡
6. è‡ªåŠ¨éƒ¨ç½²å®Œæˆ

---

### 2. Render

**ä¼˜ç‚¹ï¼š**
- å…è´¹é¢åº¦ï¼š750å°æ—¶/æœˆ
- æ— æ–‡ä»¶å¤§å°é™åˆ¶
- æ”¯æŒ Node.jsã€PostgreSQL
- è‡ªåŠ¨ HTTPS
- æ”¯æŒ WebSocket
- æ”¯æŒè‡ªå®šä¹‰åŸŸå

**ç¼ºç‚¹ï¼š**
- å…è´¹æœåŠ¡åœ¨15åˆ†é’Ÿæ— æ´»åŠ¨åä¼šä¼‘çœ 
- å›½å†…è®¿é—®å¯èƒ½è¾ƒæ…¢

**é€‚ç”¨åœºæ™¯ï¼š** ä¸­å°å‹é¡¹ç›®ï¼Œå¯ä»¥æ¥å—ä¼‘çœ å»¶è¿Ÿ

**éƒ¨ç½²æ­¥éª¤ï¼š**
1. è®¿é—® [Render.com](https://render.com)
2. ä½¿ç”¨ GitHub è´¦å·ç™»å½•
3. ç‚¹å‡» "New" â†’ "Web Service"
4. è¿æ¥ GitHub ä»“åº“
5. é…ç½®æ„å»ºå’Œå¯åŠ¨å‘½ä»¤
6. é…ç½®ç¯å¢ƒå˜é‡
7. éƒ¨ç½²å®Œæˆ

---

### 3. Fly.io

**ä¼˜ç‚¹ï¼š**
- å…è´¹é¢åº¦ï¼š3ä¸ªå…±äº«CPUã€256MB RAMçš„VMï¼ˆ2340å°æ—¶/æœˆï¼‰
- **æ— æ˜ç¡®çš„éƒ¨ç½²æ–‡ä»¶å¤§å°é™åˆ¶**ï¼ˆDockeré•œåƒå¤§å°é€šå¸¸å—é™äºæ„å»ºæ—¶é—´ï¼Œè€Œéç¡¬æ€§é™åˆ¶ï¼‰
- å…¨çƒè¾¹ç¼˜èŠ‚ç‚¹ï¼Œé€Ÿåº¦å¿«
- æ”¯æŒ Docker
- æ”¯æŒ PostgreSQL
- æ”¯æŒè‡ªå®šä¹‰åŸŸå
- æŒä¹…å­˜å‚¨ï¼š3GBï¼ˆå…è´¹é¢åº¦ï¼‰

**é™åˆ¶ï¼š**
- å…è´¹é¢åº¦ï¼š3ä¸ªå…±äº«CPUã€256MB RAMçš„VM
- æŒä¹…å­˜å‚¨ï¼š3GBï¼ˆå…è´¹é¢åº¦ï¼‰
- å¸¦å®½ï¼š160GB/æœˆï¼ˆå…è´¹é¢åº¦ï¼‰
- é…ç½®ç›¸å¯¹å¤æ‚
- éœ€è¦ Dockerfile
- æ–°è´¦æˆ·å¯èƒ½éœ€è¦ç»‘å®šä¿¡ç”¨å¡éªŒè¯

**é€‚ç”¨åœºæ™¯ï¼š** éœ€è¦å…¨çƒéƒ¨ç½²ã€å¯¹æ€§èƒ½è¦æ±‚é«˜çš„é¡¹ç›®

**éƒ¨ç½²æ­¥éª¤ï¼š**
1. å®‰è£… Fly CLI: `curl -L https://fly.io/install.sh | sh`
2. ç™»å½•: `fly auth login`
3. åˆå§‹åŒ–: `fly launch`
4. é…ç½® `fly.toml`
5. éƒ¨ç½²: `fly deploy`

**æ³¨æ„äº‹é¡¹ï¼š**
- Docker é•œåƒå¤§å°æ²¡æœ‰ç¡¬æ€§é™åˆ¶ï¼Œä½†å»ºè®®æ§åˆ¶åœ¨ 1-2GB ä»¥å†…ä»¥ä¿è¯æ„å»ºå’Œéƒ¨ç½²é€Ÿåº¦
- å¤§æ–‡ä»¶ï¼ˆå¦‚æ¨¡å‹æ–‡ä»¶ï¼‰å»ºè®®å­˜å‚¨åœ¨å¤–éƒ¨å­˜å‚¨æœåŠ¡ï¼ˆå¦‚ COSã€S3ï¼‰è€Œé Docker é•œåƒä¸­
- å¯ä»¥ä½¿ç”¨ `.dockerignore` æ’é™¤ä¸å¿…è¦çš„æ–‡ä»¶ä»¥å‡å°é•œåƒå¤§å°

---

### 4. DigitalOcean App Platform

**ä¼˜ç‚¹ï¼š**
- ç¨³å®šå¯é 
- æ”¯æŒ Node.jsã€PostgreSQL
- è‡ªåŠ¨ HTTPS
- æ”¯æŒè‡ªå®šä¹‰åŸŸå
- æœ‰å…è´¹è¯•ç”¨é¢åº¦

**ç¼ºç‚¹ï¼š**
- å…è´¹é¢åº¦è¾ƒå°‘
- éœ€è¦ä¿¡ç”¨å¡éªŒè¯

**é€‚ç”¨åœºæ™¯ï¼š** å•†ä¸šé¡¹ç›®ï¼Œéœ€è¦ç¨³å®šæœåŠ¡

**éƒ¨ç½²æ­¥éª¤ï¼š**
1. è®¿é—® [DigitalOcean](https://www.digitalocean.com)
2. æ³¨å†Œè´¦å·ï¼ˆéœ€è¦ä¿¡ç”¨å¡ï¼‰
3. åˆ›å»º App Platform åº”ç”¨
4. è¿æ¥ GitHub ä»“åº“
5. é…ç½®ç¯å¢ƒå˜é‡
6. éƒ¨ç½²å®Œæˆ

---

### 5. è…¾è®¯äº‘/é˜¿é‡Œäº‘ï¼ˆå›½å†…æ¨èï¼‰â­

**ä¼˜ç‚¹ï¼š**
- å›½å†…è®¿é—®é€Ÿåº¦å¿«
- ç¨³å®šå¯é 
- æ”¯æŒå¤šç§æœåŠ¡
- æœ‰å­¦ç”Ÿä¼˜æƒ 

**ç¼ºç‚¹ï¼š**
- éœ€è¦å®åè®¤è¯
- é…ç½®ç›¸å¯¹å¤æ‚
- éœ€è¦ä»˜è´¹ï¼ˆä½†ä»·æ ¼åˆç†ï¼‰

**é€‚ç”¨åœºæ™¯ï¼š** ä¸»è¦é¢å‘å›½å†…ç”¨æˆ·çš„é¡¹ç›®

**éƒ¨ç½²é€‰é¡¹ï¼š**
- **äº‘æœåŠ¡å™¨ï¼ˆCVM/ECSï¼‰**ï¼šè‡ªå·±æ­å»º Node.js ç¯å¢ƒ
- **Serverless äº‘å‡½æ•°**ï¼šé€‚åˆ API æœåŠ¡
- **å®¹å™¨æœåŠ¡**ï¼šä½¿ç”¨ Docker éƒ¨ç½²
- **è½»é‡åº”ç”¨æœåŠ¡å™¨**ï¼šç®€å•æ˜“ç”¨ï¼Œé€‚åˆå°å‹é¡¹ç›®

**éƒ¨ç½²æ­¥éª¤ï¼ˆä»¥è…¾è®¯äº‘è½»é‡åº”ç”¨æœåŠ¡å™¨ä¸ºä¾‹ï¼‰ï¼š**
1. è´­ä¹°è½»é‡åº”ç”¨æœåŠ¡å™¨ï¼ˆçº¦ Â¥24/æœˆï¼‰
2. å®‰è£… Node.js å’Œ PM2
3. å…‹éš†ä»£ç ä»“åº“
4. å®‰è£…ä¾èµ–ï¼š`npm install`
5. é…ç½®ç¯å¢ƒå˜é‡
6. ä½¿ç”¨ PM2 å¯åŠ¨ï¼š`pm2 start server/index.js`
7. é…ç½® Nginx åå‘ä»£ç†
8. é…ç½® SSL è¯ä¹¦

---

### 6. è‡ªå»ºæœåŠ¡å™¨ï¼ˆVPSï¼‰

**ä¼˜ç‚¹ï¼š**
- å®Œå…¨æ§åˆ¶
- æ— æ–‡ä»¶å¤§å°é™åˆ¶
- å¯ä»¥è‡ªå®šä¹‰é…ç½®
- æˆæœ¬å¯æ§

**ç¼ºç‚¹ï¼š**
- éœ€è¦è‡ªå·±ç»´æŠ¤
- éœ€è¦é…ç½®æœåŠ¡å™¨å®‰å…¨
- éœ€è¦é…ç½® SSL è¯ä¹¦

**æ¨è VPS æœåŠ¡å•†ï¼š**
- **Vultr**ï¼šå…¨çƒèŠ‚ç‚¹ï¼ŒæŒ‰å°æ—¶è®¡è´¹
- **Linode**ï¼šç¨³å®šå¯é 
- **Bandwagonï¼ˆæ¬ç“¦å·¥ï¼‰**ï¼šä»·æ ¼ä¾¿å®œ
- **è…¾è®¯äº‘/é˜¿é‡Œäº‘**ï¼šå›½å†…è®¿é—®å¿«

---

## æ¨èæ–¹æ¡ˆ

### å¯¹äºæœ¬é¡¹ç›®ï¼Œæ¨èä»¥ä¸‹æ–¹æ¡ˆï¼š

#### ğŸ† **é•¿æœŸå•†ä¸šäº§å“æ¨èï¼šè…¾è®¯äº‘**

**ç†ç”±ï¼š**
- âœ… ä¸»è¦ç”¨æˆ·åœ¨å›½å†…ï¼Œè®¿é—®é€Ÿåº¦å¿«
- âœ… æ•°æ®åˆè§„è¦æ±‚ï¼ˆæ•°æ®å­˜å‚¨åœ¨å¢ƒå†…ï¼‰
- âœ… é•¿æœŸæˆæœ¬æ›´ä½ï¼ˆçº¦ä¾¿å®œ 30-50%ï¼‰
- âœ… æŠ€æœ¯ç”Ÿæ€å®Œæ•´ï¼Œæ–¹ä¾¿æ‰©å±•
- âœ… ç¨³å®šæ€§æ›´å¥½ï¼ŒæŠ€æœ¯æ”¯æŒå®Œå–„

**è¯¦ç»†å¯¹æ¯”åˆ†æè¯·æŸ¥çœ‹ï¼š** `docs/Fly.io vs è…¾è®¯äº‘-é•¿æœŸå•†ä¸šäº§å“å¯¹æ¯”åˆ†æ.md`

#### å…¶ä»–é€‰æ‹©ï¼š

1. **å¼€å‘/æµ‹è¯•é˜¶æ®µï¼šRailway æˆ– Render**
   - ç®€å•æ˜“ç”¨
   - å…è´¹é¢åº¦è¶³å¤Ÿå¼€å‘æµ‹è¯•
   - æ— æ–‡ä»¶å¤§å°é™åˆ¶

2. **è½»é‡çº§éƒ¨ç½²ï¼šè…¾è®¯äº‘è½»é‡åº”ç”¨æœåŠ¡å™¨**
   - è®¿é—®é€Ÿåº¦å¿«
   - ä»·æ ¼åˆç†ï¼ˆçº¦ Â¥24/æœˆï¼‰
   - ç¨³å®šå¯é 

3. **å…¨çƒç”¨æˆ·ä¸ºä¸»ï¼šFly.io**
   - å…¨çƒè¾¹ç¼˜èŠ‚ç‚¹
   - æ— æ˜ç¡®çš„éƒ¨ç½²æ–‡ä»¶å¤§å°é™åˆ¶
   - é€‚åˆåŒ…å«å¤§é‡ä¾èµ–çš„é¡¹ç›®ï¼ˆå¦‚ 700MB+ï¼‰

---

## éƒ¨ç½²å‰å‡†å¤‡

### 1. ç¯å¢ƒå˜é‡é…ç½®

åˆ›å»º `.env.production` æ–‡ä»¶ï¼š

```env
# æ•°æ®åº“
DATABASE_URL=your_supabase_connection_string

# JWTå¯†é’¥
JWT_SECRET=your_jwt_secret

# COSé…ç½®
COS_SECRET_ID=your_cos_secret_id
COS_SECRET_KEY=your_cos_secret_key
COS_REGION=your_cos_region
COS_BUCKET=your_cos_bucket

# APIåŸºç¡€URL
VITE_API_BASE_URL=https://your-api-domain.com

# å…¶ä»–æœåŠ¡é…ç½®
...
```

### 2. æ„å»ºé…ç½®

ç¡®ä¿ `package.json` ä¸­æœ‰æ­£ç¡®çš„æ„å»ºè„šæœ¬ï¼š

```json
{
  "scripts": {
    "build": "vite build",
    "start": "node server/index.js",
    "dev": "vite dev"
  }
}
```

### 3. æ•°æ®åº“è¿ç§»

ç¡®ä¿ Supabase æ•°æ®åº“å·²åˆ›å»ºæ‰€æœ‰å¿…è¦çš„è¡¨ï¼š
- `projects`
- `characters`
- `scenes`
- `items`
- `generated_assets`ï¼ˆæ–°åˆ›å»ºï¼‰
- `files`
- `shots`
- `users`

---

## éƒ¨ç½²æ­¥éª¤ï¼ˆä»¥ Railway ä¸ºä¾‹ï¼‰

### 1. å‡†å¤‡ä»£ç 

ç¡®ä¿ä»£ç å·²æ¨é€åˆ° GitHubã€‚

### 2. åˆ›å»º Railway é¡¹ç›®

1. è®¿é—® [Railway.app](https://railway.app)
2. ä½¿ç”¨ GitHub ç™»å½•
3. ç‚¹å‡» "New Project"
4. é€‰æ‹© "Deploy from GitHub repo"
5. é€‰æ‹©ä½ çš„ä»“åº“

### 3. é…ç½®ç¯å¢ƒå˜é‡

åœ¨ Railway é¡¹ç›®è®¾ç½®ä¸­æ·»åŠ æ‰€æœ‰å¿…è¦çš„ç¯å¢ƒå˜é‡ã€‚

### 4. é…ç½®æ„å»ºå’Œå¯åŠ¨å‘½ä»¤

- **æ„å»ºå‘½ä»¤**ï¼š`npm install && npm run build`
- **å¯åŠ¨å‘½ä»¤**ï¼š`npm start` æˆ– `node server/index.js`

### 5. é…ç½®ç«¯å£

Railway ä¼šè‡ªåŠ¨åˆ†é…ç«¯å£ï¼Œé€šè¿‡ `PORT` ç¯å¢ƒå˜é‡è·å–ã€‚ç¡®ä¿ä»£ç ä¸­ï¼š

```javascript
const PORT = process.env.PORT || 3002
app.listen(PORT, () => {
  console.log(`Server running on port ${PORT}`)
})
```

### 6. éƒ¨ç½²

Railway ä¼šè‡ªåŠ¨æ£€æµ‹åˆ°ä»£ç æ¨é€å¹¶é‡æ–°éƒ¨ç½²ã€‚

---

## æ•°æ®æŒä¹…åŒ–è¯´æ˜

### å·²å®ç°çš„åŠŸèƒ½

1. **ç”Ÿæˆèµ„äº§è¡¨ï¼ˆgenerated_assetsï¼‰**
   - å­˜å‚¨æ‰€æœ‰ç”Ÿæˆçš„å›¾ç‰‡å’Œè§†é¢‘
   - åŒ…å«ç”¨æˆ·IDã€é¡¹ç›®IDã€COS URLç­‰ä¿¡æ¯
   - æ”¯æŒè·¨è®¾å¤‡åŒæ­¥

2. **è‡ªåŠ¨ä¿å­˜æœºåˆ¶**
   - å›¾ç‰‡ç”Ÿæˆåè‡ªåŠ¨ä¿å­˜åˆ° `generated_assets` è¡¨
   - è§†é¢‘ç”Ÿæˆåè‡ªåŠ¨ä¿å­˜åˆ° `generated_assets` è¡¨
   - ä¸Šä¼ çš„èµ„äº§ä¹Ÿä¼šä¿å­˜åˆ° `generated_assets` è¡¨

3. **APIæ¥å£**
   - `GET /api/generated-assets`ï¼šè·å–ç”¨æˆ·çš„æ‰€æœ‰ç”Ÿæˆèµ„äº§
   - æ”¯æŒæŒ‰é¡¹ç›®ã€ç±»å‹ã€åˆ†ç±»ç­›é€‰

### ä½¿ç”¨æ–¹å¼

å‰ç«¯å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–ç”Ÿæˆèµ„äº§ï¼š

```typescript
// è·å–æ‰€æœ‰ç”Ÿæˆèµ„äº§
const assets = await fetch('/api/generated-assets', {
  headers: { 'Authorization': `Bearer ${token}` }
})

// è·å–ç‰¹å®šé¡¹ç›®çš„èµ„äº§
const projectAssets = await fetch('/api/generated-assets?projectId=1', {
  headers: { 'Authorization': `Bearer ${token}` }
})

// è·å–ç‰¹å®šç±»å‹çš„èµ„äº§ï¼ˆå›¾ç‰‡/è§†é¢‘ï¼‰
const images = await fetch('/api/generated-assets?assetType=image', {
  headers: { 'Authorization': `Bearer ${token}` }
})
```

---

## æ³¨æ„äº‹é¡¹

1. **æ•°æ®åº“è¿æ¥**
   - ç¡®ä¿ Supabase æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²æ­£ç¡®
   - ç¡®ä¿æ•°æ®åº“è¡¨å·²åˆ›å»º
   - ç¡®ä¿ RLSï¼ˆRow Level Securityï¼‰ç­–ç•¥æ­£ç¡®é…ç½®

2. **COSå­˜å‚¨**
   - ç¡®ä¿ COS é…ç½®æ­£ç¡®
   - ç¡®ä¿ COS å­˜å‚¨æ¡¶æœ‰è¶³å¤Ÿçš„ç©ºé—´
   - ç¡®ä¿ COS è®¿é—®æƒé™æ­£ç¡®

3. **CORSé…ç½®**
   - ç¡®ä¿åç«¯å…è®¸å‰ç«¯åŸŸåè®¿é—®
   - é…ç½®æ­£ç¡®çš„ CORS å¤´

4. **HTTPS**
   - ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨ HTTPS
   - é…ç½® SSL è¯ä¹¦

5. **ç›‘æ§å’Œæ—¥å¿—**
   - é…ç½®é”™è¯¯ç›‘æ§ï¼ˆå¦‚ Sentryï¼‰
   - é…ç½®æ—¥å¿—æ”¶é›†
   - å®šæœŸæ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€

---

## æ€»ç»“

- **å¼€å‘/æµ‹è¯•ç¯å¢ƒ**ï¼šæ¨è Railway æˆ– Renderï¼ˆå…è´¹ï¼‰
- **å›½å†…ç”¨æˆ·**ï¼šæ¨èè…¾è®¯äº‘è½»é‡åº”ç”¨æœåŠ¡å™¨ï¼ˆçº¦ Â¥24/æœˆï¼‰
- **å•†ä¸šé¡¹ç›®**ï¼šæ¨è DigitalOcean æˆ– Fly.io
- **æ•°æ®æŒä¹…åŒ–**ï¼šå·²å®ç°ï¼Œæ‰€æœ‰ç”Ÿæˆèµ„äº§éƒ½ä¼šä¿å­˜åˆ° Supabase æ•°æ®åº“
- **è·¨è®¾å¤‡åŒæ­¥**ï¼šå·²å®ç°ï¼Œç”¨æˆ·å¯ä»¥ä»ä»»æ„è®¾å¤‡è®¿é—®è‡ªå·±çš„ç”Ÿæˆèµ„äº§

é€‰æ‹©æœ€é€‚åˆä½ éœ€æ±‚çš„æ–¹æ¡ˆå³å¯ï¼

