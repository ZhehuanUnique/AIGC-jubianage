# å¿«é€Ÿéƒ¨ç½²å‘½ä»¤æ¸…å•

## ðŸ“‹ æœåŠ¡å™¨ä¿¡æ¯
- **IP**ï¼š119.45.121.152
- **ç”¨æˆ·**ï¼šubuntu
- **å¯†ç **ï¼šrXTg#!G$6c45yxZ
- **åŸŸå**ï¼šjubianai.cn

---

## ðŸš€ ä¸€é”®éƒ¨ç½²è„šæœ¬

### æ­¥éª¤1ï¼šè¿žæŽ¥æœåŠ¡å™¨

```bash
ssh ubuntu@119.45.121.152
# è¾“å…¥å¯†ç ï¼šrXTg#!G$6c45yxZ
```

### æ­¥éª¤2ï¼šæ‰§è¡Œä¸€é”®å®‰è£…è„šæœ¬

```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£… Node.jsï¼ˆä½¿ç”¨ NVMï¼‰
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
source ~/.bashrc
nvm install 20
nvm use 20
nvm alias default 20

# å®‰è£… PM2
npm install -g pm2
pm2 startup

# å®‰è£… Nginx
sudo apt install nginx -y
sudo systemctl start nginx
sudo systemctl enable nginx

# å®‰è£… Git
sudo apt install git -y

# åˆ›å»ºé¡¹ç›®ç›®å½•
sudo mkdir -p /var/www/aigc-agent
sudo chown ubuntu:ubuntu /var/www/aigc-agent
```

### æ­¥éª¤3ï¼šä¸Šä¼ ä»£ç 

**æ–¹æ³•1ï¼šä½¿ç”¨ Gitï¼ˆæŽ¨èï¼‰**

```bash
cd /var/www/aigc-agent
git clone https://github.com/ä½ çš„ç”¨æˆ·å/AIGC-jubianage-agent.git .
```

**æ–¹æ³•2ï¼šä½¿ç”¨ SCPï¼ˆä»Žæœ¬åœ° Windows ä¸Šä¼ ï¼‰**

åœ¨ Windows PowerShell ä¸­æ‰§è¡Œï¼š

```powershell
# è¿›å…¥é¡¹ç›®ç›®å½•
cd C:\Users\Administrator\Desktop\AIGC-jubianage-agent

# ä¸Šä¼ ä»£ç ï¼ˆæŽ’é™¤ node_modulesï¼‰
scp -r -o StrictHostKeyChecking=no ^
    --exclude=node_modules ^
    --exclude=.git ^
    . ubuntu@119.45.121.152:/var/www/aigc-agent/
```

æˆ–è€…ä½¿ç”¨ WinSCP ç­‰å›¾å½¢åŒ–å·¥å…·ä¸Šä¼ ã€‚

### æ­¥éª¤4ï¼šé…ç½®çŽ¯å¢ƒå˜é‡

```bash
cd /var/www/aigc-agent/server
cp env.example .env
nano .env
```

**å¿…é¡»é…ç½®çš„é¡¹ï¼š**
```env
PORT=3002
DATABASE_URL=ä½ çš„Supabaseè¿žæŽ¥å­—ç¬¦ä¸²
JWT_SECRET=ä½ çš„JWTå¯†é’¥ï¼ˆä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ç”Ÿæˆï¼‰
COS_SECRET_ID=ä½ çš„COS Secret ID
COS_SECRET_KEY=ä½ çš„COS Secret Key
COS_REGION=ap-guangzhou
COS_BUCKET=ä½ çš„bucketåç§°
```

**ç”Ÿæˆ JWT_SECRETï¼š**
```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

### æ­¥éª¤5ï¼šå®‰è£…ä¾èµ–å¹¶æž„å»º

```bash
cd /var/www/aigc-agent

# å®‰è£…å‰ç«¯ä¾èµ–
npm install

# åˆ›å»ºç”Ÿäº§çŽ¯å¢ƒå˜é‡æ–‡ä»¶
cat > .env.production << EOF
VITE_API_BASE_URL=https://jubianai.cn/api
EOF

# æž„å»ºå‰ç«¯
npm run build

# å®‰è£…åŽç«¯ä¾èµ–
cd server
npm install
```

### æ­¥éª¤6ï¼šå¯åŠ¨åŽç«¯æœåŠ¡

```bash
cd /var/www/aigc-agent/server
pm2 start index.js --name aigc-backend
pm2 save
pm2 logs aigc-backend
```

### æ­¥éª¤7ï¼šé…ç½® Nginx

```bash
sudo nano /etc/nginx/sites-available/aigc-agent
```

**é…ç½®æ–‡ä»¶å†…å®¹ï¼š**
```nginx
server {
    listen 80;
    server_name jubianai.cn www.jubianai.cn;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /var/www/aigc-agent/dist;
        try_files $uri $uri/ /index.html;
        index index.html;
    }

    # åŽç«¯ API ä»£ç†
    location /api {
        proxy_pass http://localhost:3002;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
```

**å¯ç”¨é…ç½®ï¼šå¯ç”¨é…ç½®å¹¶æµ‹è¯•ï¼š
```bash
sudo ln -s /etc/nginx/sites-available/aigc-agent /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

### æ­¥éª¤8ï¼šé…ç½® SSL è¯ä¹¦ï¼ˆHTTPSï¼‰

```bash
# å®‰è£… Certbot
sudo apt install certbot python3-certbot-nginx -y

# èŽ·å–è¯ä¹¦ï¼ˆæ›¿æ¢ä¸ºä½ çš„é‚®ç®±ï¼‰
sudo certbot --nginx -d jubianai.cn -d www.jubianai.cn --email your@email.com --agree-tos --non-interactive
```

### æ­¥éª¤9ï¼šé…ç½®é˜²ç«å¢™

```bash
# æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€
sudo ufw status

# å¼€æ”¾å¿…è¦ç«¯å£
sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw enable
```

---

## âœ… éªŒè¯éƒ¨ç½²

### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# æ£€æŸ¥ PM2
pm2 status

# æ£€æŸ¥ Nginx
sudo systemctl status nginx

# æ£€æŸ¥ç«¯å£
sudo netstat -tlnp | grep 3002
sudo netstat -tlnp | grep 80
```

### 2. æµ‹è¯•è®¿é—®

- è®¿é—®ï¼š`http://jubianai.cn` æˆ– `https://jubianai.cn`
- åº”è¯¥èƒ½çœ‹åˆ°ç™»å½•é¡µé¢
- æµ‹è¯•ç™»å½•åŠŸèƒ½

---

## ðŸ”„ æ›´æ–°éƒ¨ç½²

```bash
cd /var/www/aigc-agent
git pull
npm install
npm run build
cd server
npm install
pm2 restart aigc-backend
```

---

## ðŸ› å¸¸è§é—®é¢˜

### æ— æ³•è¿žæŽ¥æœåŠ¡å™¨
```bash
# æ£€æŸ¥å®‰å…¨ç»„æ˜¯å¦å¼€æ”¾ 22 ç«¯å£
# åœ¨è…¾è®¯äº‘æŽ§åˆ¶å° â†’ å®‰å…¨ç»„ â†’ æ£€æŸ¥è§„åˆ™
```

### å¯†ç é”™è¯¯
```bash
# ç¡®è®¤ç”¨æˆ·åæ˜¯ ubuntuï¼ˆä¸æ˜¯ rootï¼‰
# å¯†ç æ˜¯ï¼šrXTg#!G$6c45yxZ
```

### åŸŸåæ— æ³•è®¿é—®
```bash
# 1. æ£€æŸ¥åŸŸåè§£æžæ˜¯å¦ç”Ÿæ•ˆ
ping jubianai.cn

# 2. æ£€æŸ¥ Nginx é…ç½®
sudo nginx -t

# 3. æ£€æŸ¥é˜²ç«å¢™
sudo ufw status
```

### åŽç«¯æ— æ³•å¯åŠ¨
```bash
# æŸ¥çœ‹æ—¥å¿—
pm2 logs aigc-backend

# æ£€æŸ¥çŽ¯å¢ƒå˜é‡
cd /var/www/aigc-agent/server
cat .env
```

---

## ðŸ“ž éœ€è¦å¸®åŠ©ï¼Ÿ

æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ï¼š
- `docs/è…¾è®¯äº‘éƒ¨ç½²å®Œæ•´æŒ‡å—.md`
- `docs/æœåŠ¡å™¨ä¿¡æ¯.md`

