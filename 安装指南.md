# 家庭电脑安装指南

本文档列出了在家庭电脑上运行此项目所需安装的所有软件和依赖。

## ⚠️ 重要说明

**不需要安装 ollama！**

本项目**不使用 ollama**。项目中的 RAG（检索增强生成）功能使用的是：
- **CLIP 模型**（通过 sentence-transformers）：用于图像向量化
- **Chroma 向量数据库**：用于存储和检索向量
- **LangGraph**：用于工作流管理

这些依赖会在安装 Python 包时自动安装，**不需要单独安装 ollama**。

---

## 📋 必需软件清单

### 1. Node.js 和 npm（前端必需）

**用途**：运行 Nuxt 3 前端应用

**安装步骤**：
1. 访问 [Node.js 官网](https://nodejs.org/)
2. 下载 **LTS 版本**（推荐 18.x 或 20.x）
3. 运行安装程序，按默认选项安装
4. 验证安装：
   ```bash
   node --version
   npm --version
   ```

**版本要求**：
- Node.js: 18.x 或更高版本
- npm: 9.x 或更高版本（随 Node.js 自动安装）

---

### 2. Python（后端必需）

**用途**：运行 FastAPI 后端服务

**安装步骤**：
1. 访问 [Python 官网](https://www.python.org/downloads/)
2. 下载 **Python 3.11.0** 或更高版本（项目推荐 3.11.0）
3. ⚠️ **重要**：安装时勾选 "Add Python to PATH"
4. 验证安装：
   ```bash
   python --version
   pip --version
   ```

**版本要求**：
- Python: 3.8+（推荐 3.11.0）
- pip: 随 Python 自动安装

---

### 3. Git（可选，但推荐）

**用途**：克隆和更新项目代码

**安装步骤**：
1. 访问 [Git 官网](https://git-scm.com/downloads)
2. 下载并安装 Git for Windows
3. 验证安装：
   ```bash
   git --version
   ```

---

## 📦 项目依赖安装

### 前端依赖安装

1. **进入前端目录**：
   ```bash
   cd frontend-nuxt
   ```

2. **安装依赖**：
   ```bash
   npm install
   ```

   这会自动安装以下依赖：
   - Nuxt 3
   - Vue 3
   - TypeScript
   - Tailwind CSS
   - Pinia（状态管理）

---

### 后端依赖安装

1. **进入后端目录**：
   ```bash
   cd jubianai
   ```

2. **安装依赖**：
   ```bash
   pip install -r requirements.txt
   ```

   这会安装以下主要依赖：
   - FastAPI（Web 框架）
   - Uvicorn（ASGI 服务器）
   - 火山引擎 SDK
   - PostgreSQL 驱动（psycopg2-binary）
   - Supabase 客户端
   - 其他依赖...

---

## ⚙️ 环境配置

### 1. 后端环境变量配置

1. **复制环境变量模板**：
   ```bash
   cd jubianai
   copy env.example .env  # Windows
   # 或
   cp env.example .env   # Linux/Mac
   ```

2. **编辑 `.env` 文件**，填入以下必需配置：
   ```env
   # 即梦 AI (火山引擎) API 配置（必需）
   VOLCENGINE_ACCESS_KEY_ID=你的AccessKeyID
   VOLCENGINE_SECRET_ACCESS_KEY=你的SecretAccessKey
   JIMENG_API_ENDPOINT=https://visual.volcengineapi.com

   # 服务器配置
   HOST=0.0.0.0
   PORT=8000

   # Supabase 数据库配置（可选，用于历史记录功能）
   SUPABASE_DB_URL=postgresql://postgres:[密码]@[项目ID].supabase.co:5432/postgres
   ```

   ⚠️ **重要**：
   - 火山引擎 API 密钥是**必需**的，否则无法生成视频
   - 数据库配置是**可选**的，如果不配置，历史记录功能将不可用

---

### 2. 前端环境变量配置（可选）

如果需要连接本地后端，创建 `frontend-nuxt/.env`：

```env
BACKEND_URL=http://localhost:8000
```

如果不创建此文件，前端默认连接到线上后端：`https://jubianai-backend.onrender.com`

---

## 🚀 启动项目

### 启动后端服务

**Windows**：
```bash
cd jubianai
python -m uvicorn backend.api:app --host 0.0.0.0 --port 8000
```

**Linux/Mac**：
```bash
cd jubianai
python3 -m uvicorn backend.api:app --host 0.0.0.0 --port 8000
```

后端服务将在 `http://localhost:8000` 启动

---

### 启动前端服务

**Windows/Linux/Mac**：
```bash
cd frontend-nuxt
npm run dev
```

前端服务将在 `http://localhost:3001` 启动

---

## 🌐 访问应用

在浏览器中打开：**http://localhost:3001**

---

## ✅ 安装验证清单

在开始使用前，请确认以下项目：

- [ ] Node.js 已安装（`node --version` 显示版本号）
- [ ] npm 已安装（`npm --version` 显示版本号）
- [ ] Python 已安装（`python --version` 显示 3.8+）
- [ ] pip 已安装（`pip --version` 显示版本号）
- [ ] 前端依赖已安装（`frontend-nuxt/node_modules` 目录存在）
- [ ] 后端依赖已安装（可以运行 `pip list` 查看已安装包）
- [ ] 后端环境变量已配置（`jubianai/.env` 文件存在且包含 API 密钥）
- [ ] 后端服务可以启动（访问 `http://localhost:8000/health` 返回正常）
- [ ] 前端服务可以启动（访问 `http://localhost:3001` 显示页面）

---

## 🔧 可选组件（按需安装）

### PostgreSQL（如果使用数据库功能）

如果需要在本地使用数据库功能，可以安装 PostgreSQL：

1. 访问 [PostgreSQL 官网](https://www.postgresql.org/download/)
2. 下载并安装 PostgreSQL
3. 创建数据库并配置连接字符串

**或者**使用 Supabase（云数据库，免费）：
- 访问 [Supabase](https://supabase.com)
- 创建项目并获取连接字符串
- 配置到 `jubianai/.env` 中的 `SUPABASE_DB_URL`

---

### FFmpeg（如果使用视频处理功能）

如果需要进行视频处理，需要安装 FFmpeg：

**Windows**：
1. 访问 [FFmpeg 官网](https://ffmpeg.org/download.html)
2. 下载 Windows 版本
3. 解压并添加到系统 PATH

**验证安装**：
```bash
ffmpeg -version
```

---

## 🐛 常见问题

### 0. 需要安装 ollama 吗？

**不需要！** 本项目不使用 ollama。

- 视频生成使用的是**即梦 AI（火山引擎）的 API**，不需要本地模型
- RAG 功能使用的是 **CLIP 模型**（图像向量化），通过 `sentence-transformers` 自动下载
- 所有 Python 依赖都会在运行 `pip install -r requirements.txt` 时自动安装

---

### 1. Python 命令找不到

**问题**：运行 `python` 提示找不到命令

**解决**：
- Windows：安装时勾选 "Add Python to PATH"
- 或使用 `py` 命令代替 `python`
- 或手动添加 Python 到系统 PATH

---

### 2. npm install 失败

**问题**：安装依赖时出错

**解决**：
- 检查网络连接
- 尝试使用国内镜像：
  ```bash
  npm config set registry https://registry.npmmirror.com
  ```
- 清除缓存后重试：
  ```bash
  npm cache clean --force
  npm install
  ```

---

### 3. pip install 失败

**问题**：安装 Python 依赖时出错

**解决**：
- 升级 pip：
  ```bash
  python -m pip install --upgrade pip
  ```
- 使用国内镜像：
  ```bash
  pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
  ```

---

### 4. 端口被占用

**问题**：8000 或 3001 端口已被占用

**解决**：
- 修改端口：
  - 后端：修改启动命令中的 `--port 8000` 为其他端口
  - 前端：修改 `frontend-nuxt/nuxt.config.ts` 中的 `port: 3001`
- 或关闭占用端口的程序

---

### 5. API 密钥错误

**问题**：视频生成失败，提示 Access Denied

**解决**：
- 检查 `jubianai/.env` 文件中的 API 密钥是否正确
- 确认密钥格式正确（无多余空格）
- 确认密钥有权限访问即梦 API

---

## 📞 获取帮助

如果遇到问题：
1. 查看项目 README.md 中的故障排除章节
2. 检查后端日志（终端输出）
3. 检查浏览器控制台（F12）的错误信息

---

## 📝 总结

**最小安装要求**：
1. ✅ Node.js 18+ 和 npm
2. ✅ Python 3.8+ 和 pip
3. ✅ 前端依赖（`npm install`）
4. ✅ 后端依赖（`pip install -r requirements.txt`）
5. ✅ 后端环境变量配置（API 密钥）

安装完成后，按照"启动项目"章节的步骤启动服务即可在浏览器中访问应用。

