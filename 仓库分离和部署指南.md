# ä»“åº“åˆ†ç¦»å’Œéƒ¨ç½²æŒ‡å—

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•å°† `doubao-rag` å’Œ `jubianai` åˆ†ç¦»ä¸ºç‹¬ç«‹çš„ GitHub ä»“åº“ï¼Œä»¥åŠå¦‚ä½•é…ç½® Vercel å’Œ Docker éƒ¨ç½²ã€‚

## ğŸ“‹ ç›®å½•

1. [ä»“åº“åˆ†ç¦»æ­¥éª¤](#ä»“åº“åˆ†ç¦»æ­¥éª¤)
2. [Vercel é…ç½®](#vercel-é…ç½®)
3. [Docker éƒ¨ç½²é…ç½®](#docker-éƒ¨ç½²é…ç½®)
4. [å¼‚åœ°éƒ¨ç½²æ–¹æ¡ˆ](#å¼‚åœ°éƒ¨ç½²æ–¹æ¡ˆ)

---

## ğŸ”€ ä»“åº“åˆ†ç¦»æ­¥éª¤

### 1. åˆ›å»ºæ–°çš„ GitHub ä»“åº“

#### åˆ›å»º `jubianai-backend` ä»“åº“

```bash
# 1. åœ¨ GitHub ä¸Šåˆ›å»ºæ–°ä»“åº“ï¼šjubianai-backend
# 2. å…‹éš†ä¸»ä»“åº“ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
cd /path/to/workspace
git clone https://github.com/ZhehuanUnique/AIGC-jubianage.git
cd AIGC-jubianage

# 3. åˆ›å»º jubianai å­ä»“åº“
cd jubianai
git init
git add .
git commit -m "Initial commit: jubianai backend service"

# 4. æ·»åŠ è¿œç¨‹ä»“åº“
git remote add origin https://github.com/ZhehuanUnique/jubianai-backend.git
git branch -M main
git push -u origin main
```

#### åˆ›å»º `doubao-rag` ä»“åº“

```bash
# 1. åœ¨ GitHub ä¸Šåˆ›å»ºæ–°ä»“åº“ï¼šdoubao-rag-service
# 2. è¿›å…¥ doubao-rag ç›®å½•
cd ../doubao-rag

# 3. åˆå§‹åŒ– Git
git init
git add .
git commit -m "Initial commit: doubao-rag service"

# 4. æ·»åŠ è¿œç¨‹ä»“åº“
git remote add origin https://github.com/ZhehuanUnique/doubao-rag-service.git
git branch -M main
git push -u origin main
```

### 2. æ›´æ–°ä¸»ä»“åº“

åœ¨ä¸»ä»“åº“ä¸­ï¼Œå°†è¿™ä¸¤ä¸ªç›®å½•æ·»åŠ åˆ° `.gitignore`ï¼š

```bash
# åœ¨ AIGC-jubianage æ ¹ç›®å½•
echo "jubianai/" >> .gitignore
echo "doubao-rag/" >> .gitignore
git add .gitignore
git commit -m "Remove jubianai and doubao-rag, moved to separate repos"
git push
```

### 3. ä½¿ç”¨ Git Submoduleï¼ˆæ¨èï¼‰

å¦‚æœéœ€è¦åœ¨ä¸»ä»“åº“ä¸­å¼•ç”¨è¿™ä¸¤ä¸ªæœåŠ¡ï¼Œå¯ä»¥ä½¿ç”¨ Git Submoduleï¼š

```bash
# åœ¨ä¸»ä»“åº“ä¸­
cd AIGC-jubianage

# æ·»åŠ  submodule
git submodule add https://github.com/ZhehuanUnique/jubianai-backend.git jubianai
git submodule add https://github.com/ZhehuanUnique/doubao-rag-service.git doubao-rag

# æäº¤ submodule å¼•ç”¨
git add .gitmodules jubianai doubao-rag
git commit -m "Add jubianai and doubao-rag as submodules"
git push
```

---

## âš™ï¸ Vercel é…ç½®

### ä¸»å‰ç«¯é¡¹ç›®ï¼ˆfrontend-nuxtï¼‰

Vercel é…ç½®å·²åœ¨ `frontend-nuxt/vercel.json` ä¸­ï¼š

```json
{
  "buildCommand": "npm run build",
  "outputDirectory": ".output/public",
  "devCommand": "npm run dev",
  "installCommand": "npm install",
  "framework": "nuxtjs",
  "routes": [
    {
      "src": "/",
      "dest": "/index.html"
    },
    {
      "src": "/(.*)",
      "dest": "/index.html"
    }
  ]
}
```

**Vercel é¡¹ç›®è®¾ç½®ï¼š**
- **Root Directory**: `frontend-nuxt`
- **Framework Preset**: `Nuxt.js`
- **Build Command**: `npm run build`ï¼ˆè‡ªåŠ¨æ£€æµ‹ï¼‰
- **Output Directory**: `.output/public`ï¼ˆè‡ªåŠ¨æ£€æµ‹ï¼‰

### ç¯å¢ƒå˜é‡é…ç½®

åœ¨ Vercel Dashboard â†’ Settings â†’ Environment Variables ä¸­æ·»åŠ ï¼š

```env
# åç«¯ API åœ°å€
BACKEND_URL=https://jubianai-backend.onrender.com

# å¦‚æœä½¿ç”¨ COS å­˜å‚¨
COS_BASE_URL=https://jubianage-1392491103.cos.ap-guangzhou.myqcloud.com
```

---

## ğŸ³ Docker éƒ¨ç½²é…ç½®

### 1. jubianai-backend Docker é…ç½®

åœ¨ `jubianai-backend` ä»“åº“æ ¹ç›®å½•åˆ›å»ºä»¥ä¸‹æ–‡ä»¶ï¼š

#### `Dockerfile`

```dockerfile
FROM python:3.11-slim

WORKDIR /app

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y \
    gcc \
    postgresql-client \
    && rm -rf /var/lib/apt/lists/*

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY requirements.txt .

# å®‰è£… Python ä¾èµ–
RUN pip install --no-cache-dir -r requirements.txt

# å¤åˆ¶åº”ç”¨ä»£ç 
COPY . .

# æš´éœ²ç«¯å£
EXPOSE 8000

# å¯åŠ¨å‘½ä»¤
CMD ["uvicorn", "backend.api:app", "--host", "0.0.0.0", "--port", "8000"]
```

#### `docker-compose.yml`

```yaml
version: '3.8'

services:
  jubianai-backend:
    build: .
    container_name: jubianai-backend
    ports:
      - "8000:8000"
    environment:
      - HOST=0.0.0.0
      - PORT=8000
      - VOLCENGINE_ACCESS_KEY_ID=${VOLCENGINE_ACCESS_KEY_ID}
      - VOLCENGINE_SECRET_ACCESS_KEY=${VOLCENGINE_SECRET_ACCESS_KEY}
      - SUPABASE_DB_URL=${SUPABASE_DB_URL}
      - DEFAULT_API_KEY=${DEFAULT_API_KEY}
    volumes:
      - ./logs:/app/logs
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
```

#### `.dockerignore`

```
__pycache__
*.pyc
*.pyo
*.pyd
.Python
env/
venv/
.venv/
*.egg-info/
.git
.gitignore
README.md
.env
*.log
```

### 2. doubao-rag Docker é…ç½®

åœ¨ `doubao-rag-service` ä»“åº“æ ¹ç›®å½•åˆ›å»ºï¼š

#### `Dockerfile`

```dockerfile
FROM python:3.11-slim

WORKDIR /app

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y \
    gcc \
    g++ \
    ffmpeg \
    libgl1-mesa-glx \
    libglib2.0-0 \
    && rm -rf /var/lib/apt/lists/*

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY requirements.txt .

# å®‰è£… Python ä¾èµ–ï¼ˆæ³¨æ„ï¼štokenizers éœ€è¦ç‰¹æ®Šå¤„ç†ï¼‰
RUN pip install --no-cache-dir tokenizers==0.15.0 && \
    pip install --no-cache-dir -r requirements.txt

# å¤åˆ¶åº”ç”¨ä»£ç 
COPY . .

# åˆ›å»ºå¿…è¦çš„ç›®å½•
RUN mkdir -p uploads vector_db frames

# æš´éœ²ç«¯å£
EXPOSE 8001

# å¯åŠ¨å‘½ä»¤
CMD ["uvicorn", "backend.api:app", "--host", "0.0.0.0", "--port", "8001"]
```

#### `docker-compose.yml`

```yaml
version: '3.8'

services:
  doubao-rag:
    build: .
    container_name: doubao-rag
    ports:
      - "8001:8001"
    environment:
      - HOST=0.0.0.0
      - PORT=8001
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - CHROMA_PERSIST_DIR=/app/vector_db
    volumes:
      - ./vector_db:/app/vector_db
      - ./uploads:/app/uploads
      - ./frames:/app/frames
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8001/health"]
      interval: 30s
      timeout: 10s
      retries: 3
```

### 3. ä½¿ç”¨ Docker Compose å¯åŠ¨

#### jubianai-backend

```bash
cd jubianai-backend
cp env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥é…ç½®

docker-compose up -d
```

#### doubao-rag-service

```bash
cd doubao-rag-service
cp env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥é…ç½®

docker-compose up -d
```

---

## ğŸŒ å¼‚åœ°éƒ¨ç½²æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: ä½¿ç”¨ Docker + äº‘æœåŠ¡å™¨

#### éƒ¨ç½²æ­¥éª¤

1. **å‡†å¤‡æœåŠ¡å™¨**
   - é€‰æ‹©äº‘æœåŠ¡å•†ï¼ˆé˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€AWSç­‰ï¼‰
   - å®‰è£… Docker å’Œ Docker Compose

2. **å…‹éš†ä»“åº“**
   ```bash
   git clone https://github.com/ZhehuanUnique/jubianai-backend.git
   git clone https://github.com/ZhehuanUnique/doubao-rag-service.git
   ```

3. **é…ç½®ç¯å¢ƒå˜é‡**
   ```bash
   # åœ¨æ¯ä¸ªæœåŠ¡ç›®å½•åˆ›å»º .env æ–‡ä»¶
   # å¡«å…¥ç›¸åº”çš„é…ç½®
   ```

4. **å¯åŠ¨æœåŠ¡**
   ```bash
   # jubianai-backend
   cd jubianai-backend
   docker-compose up -d

   # doubao-rag-service
   cd doubao-rag-service
   docker-compose up -d
   ```

5. **é…ç½® Nginx åå‘ä»£ç†ï¼ˆå¯é€‰ï¼‰**
   ```nginx
   # /etc/nginx/sites-available/jubianai
   server {
       listen 80;
       server_name your-domain.com;

       location /api/ {
           proxy_pass http://localhost:8000/;
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
       }

       location /rag/ {
           proxy_pass http://localhost:8001/;
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
       }
   }
   ```

### æ–¹æ¡ˆ 2: ä½¿ç”¨ Docker Swarmï¼ˆå¤šèŠ‚ç‚¹ï¼‰

é€‚ç”¨äºéœ€è¦é«˜å¯ç”¨æ€§çš„åœºæ™¯ï¼š

```bash
# åˆå§‹åŒ– Swarm
docker swarm init

# åˆ›å»º overlay ç½‘ç»œ
docker network create --driver overlay jubianai-network

# éƒ¨ç½²æœåŠ¡
docker stack deploy -c docker-compose.yml jubianai-backend
docker stack deploy -c docker-compose.yml doubao-rag
```

### æ–¹æ¡ˆ 3: ä½¿ç”¨ Kubernetesï¼ˆK8sï¼‰

åˆ›å»º Kubernetes éƒ¨ç½²æ–‡ä»¶ï¼š

#### `jubianai-deployment.yaml`

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: jubianai-backend
spec:
  replicas: 2
  selector:
    matchLabels:
      app: jubianai-backend
  template:
    metadata:
      labels:
        app: jubianai-backend
    spec:
      containers:
      - name: jubianai-backend
        image: your-registry/jubianai-backend:latest
        ports:
        - containerPort: 8000
        env:
        - name: VOLCENGINE_ACCESS_KEY_ID
          valueFrom:
            secretKeyRef:
              name: jubianai-secrets
              key: volcengine-access-key-id
        - name: VOLCENGINE_SECRET_ACCESS_KEY
          valueFrom:
            secretKeyRef:
              name: jubianai-secrets
              key: volcengine-secret-access-key
---
apiVersion: v1
kind: Service
metadata:
  name: jubianai-backend-service
spec:
  selector:
    app: jubianai-backend
  ports:
  - protocol: TCP
    port: 80
    targetPort: 8000
  type: LoadBalancer
```

---

## ğŸ“ ç¯å¢ƒå˜é‡æ¸…å•

### jubianai-backend

```env
# æœåŠ¡å™¨é…ç½®
HOST=0.0.0.0
PORT=8000

# å³æ¢¦ API
VOLCENGINE_ACCESS_KEY_ID=your_key
VOLCENGINE_SECRET_ACCESS_KEY=your_secret
JIMENG_API_ENDPOINT=https://visual.volcengineapi.com

# æ•°æ®åº“
SUPABASE_DB_URL=postgresql://...

# API Key
DEFAULT_API_KEY=default_key
```

### doubao-rag-service

```env
# æœåŠ¡å™¨é…ç½®
HOST=0.0.0.0
PORT=8001

# OpenAI APIï¼ˆå¦‚æœä½¿ç”¨ï¼‰
OPENAI_API_KEY=your_key

# Chroma æ•°æ®åº“
CHROMA_PERSIST_DIR=/app/vector_db
```

---

## ğŸ”§ ç»´æŠ¤å’Œæ›´æ–°

### æ›´æ–°æœåŠ¡

```bash
# æ‹‰å–æœ€æ–°ä»£ç 
git pull

# é‡æ–°æ„å»ºé•œåƒ
docker-compose build

# é‡å¯æœåŠ¡
docker-compose up -d
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# jubianai-backend
docker-compose logs -f jubianai-backend

# doubao-rag
docker-compose logs -f doubao-rag
```

### å¤‡ä»½æ•°æ®

```bash
# å¤‡ä»½ doubao-rag çš„å‘é‡æ•°æ®åº“
docker-compose exec doubao-rag tar -czf /backup/vector_db_backup.tar.gz /app/vector_db
```

---

## âœ… æ£€æŸ¥æ¸…å•

### åˆ†ç¦»ä»“åº“å‰
- [ ] å¤‡ä»½å½“å‰ä»£ç 
- [ ] ç¡®è®¤ä¸¤ä¸ªæœåŠ¡å¯ä»¥ç‹¬ç«‹è¿è¡Œ
- [ ] æ£€æŸ¥ä¾èµ–å…³ç³»

### åˆ†ç¦»ä»“åº“å
- [ ] åˆ›å»ºæ–°çš„ GitHub ä»“åº“
- [ ] æ¨é€ä»£ç åˆ°æ–°ä»“åº“
- [ ] æ›´æ–°ä¸»ä»“åº“çš„ `.gitignore`
- [ ] æµ‹è¯•ç‹¬ç«‹éƒ¨ç½²

### Docker éƒ¨ç½²å‰
- [ ] å®‰è£… Docker å’Œ Docker Compose
- [ ] é…ç½®ç¯å¢ƒå˜é‡
- [ ] æµ‹è¯•æœ¬åœ° Docker è¿è¡Œ
- [ ] å‡†å¤‡æœåŠ¡å™¨èµ„æº

### éƒ¨ç½²å
- [ ] éªŒè¯æœåŠ¡å¥åº·æ£€æŸ¥
- [ ] æµ‹è¯• API æ¥å£
- [ ] é…ç½®ç›‘æ§å’Œæ—¥å¿—
- [ ] è®¾ç½®è‡ªåŠ¨å¤‡ä»½

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Docker å®˜æ–¹æ–‡æ¡£](https://docs.docker.com/)
- [Docker Compose æ–‡æ¡£](https://docs.docker.com/compose/)
- [Vercel éƒ¨ç½²æ–‡æ¡£](https://vercel.com/docs)
- [Kubernetes æ–‡æ¡£](https://kubernetes.io/docs/)

---

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•åœ¨ä¸åŒæœåŠ¡å™¨é—´åŒæ­¥æ•°æ®ï¼Ÿ

A: ä½¿ç”¨å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼ˆå¦‚è…¾è®¯äº‘ COSã€é˜¿é‡Œäº‘ OSSï¼‰å­˜å‚¨å…±äº«æ•°æ®ï¼Œæˆ–ä½¿ç”¨æ•°æ®åº“åŒæ­¥ã€‚

### Q: Docker å®¹å™¨æ— æ³•è®¿é—®å¤–éƒ¨ APIï¼Ÿ

A: æ£€æŸ¥ç½‘ç»œé…ç½®å’Œé˜²ç«å¢™è®¾ç½®ï¼Œç¡®ä¿å®¹å™¨å¯ä»¥è®¿é—®äº’è”ç½‘ã€‚

### Q: å¦‚ä½•å®ç°è´Ÿè½½å‡è¡¡ï¼Ÿ

A: ä½¿ç”¨ Nginxã€HAProxy æˆ–äº‘æœåŠ¡å•†çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œé…ç½®å¤šä¸ªæœåŠ¡å®ä¾‹ã€‚

### Q: å¦‚ä½•ç›‘æ§æœåŠ¡çŠ¶æ€ï¼Ÿ

A: ä½¿ç”¨ Prometheus + Grafanaï¼Œæˆ–äº‘æœåŠ¡å•†çš„ç›‘æ§æœåŠ¡ã€‚

---

**æœ€åæ›´æ–°**: 2025-12-28

